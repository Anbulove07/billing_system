<!doctype html>
        <html>
        <head>
          <meta charset="utf-8">
          <meta name="viewport" content="width=device-width, initial-scale=1">
          <title>Invoice</title>
          <style>body{font-family: Arial, sans-serif; padding:20px} table{border-collapse: collapse} td, th{padding:6px 10px; border:1px solid #ccc}</style>
        </head>
        <body>
          <h1>Invoice - Purchase #{{purchase.id}}</h1>
          <p>Customer ID: {{purchase.customer_id}} | Time: {{purchase.timestamp}}</p>
          <table>
            <tr><th>Product</th><th>Qty</th><th>Unit</th><th>Tax%</th><th>Line Total</th></tr>
            {% for it in items %}
              <tr>
                <td>{{it.product_code}}</td>
                <td>{{it.qty}}</td>
                <td>{{it.unit_price}}</td>
                <td>{{it.tax_percent}}</td>
                <td>{{"{:.2f}".format(it.line_total)}}</td>
              </tr>
            {% endfor %}
          </table>
          <p>Total: {{"{:.2f}".format(total)}}</p>
          <p>Paid: {{"{:.2f}".format(paid)}}</p>
          <p>Change to return: {{"{:.2f}".format(change)}}</p>

          {% if change_breakdown %}
            <h3>Denomination Breakdown</h3>
            <ul>
            {% for val, cnt in change_breakdown.items() %}
              <li>{{val}} x {{cnt}}</li>
            {% endfor %}
            </ul>
          {% endif %}

          {% if leftover and leftover > 0 %}
            <p style="color: red;">Unable to return exact change. Remaining: {{leftover}}</p>
          {% endif %}

          <p><a href="/">Back to Billing</a></p>
        </body>
        </html>
